<!doctype html>
<html class="no-js" lang="en" xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">

<head>

</head>

<body>

    <article class="content item-editor-page" layout:fragment="~{content}">
        <!--    Title   -->
        <div class="title-block">
            <h3 class="title"> Create user <span class="sparkline bar" data-type="bar"></span>
            </h3>
        </div>
        <!--    Form   -->
        <form th:action="@{/user/{id}(id=${user.id})}" th:object="${user}" method="POST" name="item">
            <input th:field="${user.id}" type="text" id="idField" hidden>
            <div class="card card-block">
                <!--    Email field   -->
                <div class="form-group row">
                    <label class="col-sm-2 form-control-label text-xs-right"> Email: </label>

                    <div sec:authorize="isAnonymous()" class="col-sm-10 mb-3">
                        <span class="error-message" th:if="${#fields.hasErrors('${user.author}')}"
                              th:errors="${user.username}"></span>
                        <input type="text" th:field="${user.username}" class="form-control boxed">
                    </div>

                </div>
                <!--    Subject field   -->
                <div class="form-group row">
                    <label class="col-sm-2 form-control-label text-xs-right"> First Name: </label>
                    <div class="col-sm-10 mb-3">
                        <input th:field="${user.firstName}" type="text" class="form-control boxed" placeholder="">
                    </div>
                </div>
                 <!--    Subject field   -->
                 <div class="form-group row">
                    <label class="col-sm-2 form-control-label text-xs-right"> Last Name: </label>
                    <div class="col-sm-10 mb-3">
                        <input th:field="${user.lastName}" type="text" class="form-control boxed" placeholder="">
                    </div>
                </div>
                <!--    Department dropdown   -->
                <div class="form-group row">
                    <label class="col-sm-2 form-control-label text-xs-right"> Department: </label>
                    <div  class="col-sm-4">
                        <ul>
                            <li th:each="department : user.departments" th:text="${department.name}"><button type="button" id="remove-department-button"
                                class="btn btn-secondary rounded"> Remove Department
                           </button></li>
                        </ul>
                    </div>
                    <div class="col-sm-4">
                        <select th:field="${user.department.name}" class="c-select form-control boxed">
                            <option th:each="d : ${departments}" th:value="${d.name}" th:text="${d.name}">
                        </select>
                    </div>
                    <button type="button" id="add-department-button"
                                                                 class="btn btn-primary rounded"> Add Department
                                                            </button>
                    </div>
                <!--    Content field   -->
                <div class="form-group row">
                    <label class="col-sm-2 form-control-label text-xs-right"> Content: </label>
                  <div class="col-sm-10">  <textarea th:field="${user.events[0].content}" class="form-control boxed user-content-area"></textarea>
                    <span class="error-message" th:if="${#fields.hasErrors('${user.events}')}"
                             >Cannot be empty</span>
                  </div>
                </div>
                
                <!--    Submit button   -->
                <div class="form-group row">
                    <div class="col-sm-10 col-sm-offset-2">
                        <button type="submit" class="btn btn-primary"> Submit </button>
                    </div>
                </div>
            </div>
        </form>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <script>
            $("#add-department-button, #remove-department-button").click(function(){
                var userId = $("#idField").value;
                var endpoint = $(this).attr("id").value == 'remove-department' ? 'remove' : 'add';
                var url = url = window.location.protocol + '//' + window.location.hostname +
                            (window.location.port ? ':' + window.location.port : '') + '/user/' + userId + '/department/' + endpoint;
            });
        </script>
           <!--    Sends csrf token with every request    -->
           <script>
            $(function () {
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                $(document).ajaxSend(function (e, xhr, options) {
                    xhr.setRequestHeader(header, token);
                });
            });
        </script>
    </article>

</body>

</html>